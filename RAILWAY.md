# Деплой на Railway

## Что подготовлено

- **Procfile** — запуск через `run.sh`: миграции, `collectstatic`, создание суперпользователя root/root, gunicorn.
- **Суперпользователь по умолчанию:** логин `root`, пароль `root` (создаётся автоматически при первом запуске, если суперпользователей ещё нет).
- **WhiteNoise** — раздача статики без отдельного сервера.
- **База данных:** всегда SQLite (`db.sqlite3`). На Railway файловая система эфемерная — при пересоздании контейнера данные могут теряться; для долгого хранения рассмотрите volume или внешнее хранилище.

## Шаги деплоя

1. Создайте проект на [Railway](https://railway.app), подключите репозиторий с этим кодом.

2. В настройках сервиса приложения задайте переменные окружения:

   | Переменная | Пример | Описание |
   |------------|--------|----------|
   | `DJANGO_SECRET_KEY` | длинная случайная строка | Обязательно в production. |
   | `DEBUG` | `False` | В production лучше выключить. |
   | `ALLOWED_HOSTS` | `ваш-домен.railway.app,.railway.app` | Домен вашего приложения. |
   | `CSRF_TRUSTED_ORIGINS` | `https://web-production-fe99d.up.railway.app` | **Обязательно** для входа в `/adminka/login/`. Укажите точный URL вашего приложения (из адресной строки браузера). Без этого будет ошибка 403 CSRF при отправке формы входа. |

3. **Start Command** можно не указывать — используется команда из Procfile (`web: sh run.sh`). Если нужно переопределить, укажите:
   ```bash
   sh run.sh
   ```

4. Деплой: Railway соберёт образ, установит зависимости, при запуске выполнит миграции, collectstatic, создание root/root и запустит gunicorn.

5. После деплоя откройте `https://ваш-домен.railway.app/admin/` и войдите: **root** / **root**. Сразу смените пароль в админке (Profile → Change password).

## Локальная проверка (как на Railway)

```bash
pip install -r requirements.txt
set PORT=8000
sh run.sh
```

(На Windows вместо `sh run.sh` можно по очереди выполнить команды из `run.sh` в PowerShell, заменив `$PORT` на 8000.)
