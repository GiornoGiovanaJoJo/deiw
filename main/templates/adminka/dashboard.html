{% extends 'adminka/base.html' %}
{% load static %}

{% block title %}Панель управления - Empire Premium{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'adminka/css/pages/index.css' %}" />
{% endblock %}

{% block content %}
<main class="dashboard">
  <h1><span data-i18n="index.welcome">Добро пожаловать,</span> {{ admin_name }}!</h1>

  {% if messages %}
    {% for message in messages %}
      <div class="form-message {% if message.tags %}{{ message.tags }}{% endif %}" style="margin-bottom: 1rem;">
        {{ message }}
      </div>
    {% endfor %}
  {% endif %}

  <div class="stats" data-aos="fade-up" data-aos-delay="100">
    <div class="stat-card">
      <h2>{{ stats.total_projects }}</h2>
      <p data-i18n="index.stats.projects">Всего проектов</p>
    </div>
    <div class="stat-card">
      <h2>{{ stats.completed_projects }}</h2>
      <p data-i18n="index.stats.completed">Завершенных</p>
    </div>
    <div class="stat-card">
      <h2>{{ stats.in_progress_projects }}</h2>
      <p data-i18n="index.stats.in_progress">В работе</p>
    </div>
    <div class="stat-card">
      <h2>{{ stats.new_applications }}</h2>
      <p>Новых заявок</p>
    </div>
    <div class="stat-card">
      <h2>{{ stats.new_support }}</h2>
      <p>В поддержке</p>
    </div>
  </div>

  <div class="card orders-card" data-aos="fade-up" data-aos-delay="300">
    <h2>Последние заявки <a href="{% url 'main:adminka_requests' %}" style="font-size: 0.85rem; font-weight: 500;">→ все</a></h2>
    {% if recent_applications %}
    <table class="orders-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Имя</th>
          <th>Email</th>
          <th>Категория</th>
          <th>Статус</th>
          <th>Дата</th>
          <th>Действия</th>
        </tr>
      </thead>
      <tbody>
        {% for req in recent_applications %}
        <tr>
          <td>{{ req.id }}</td>
          <td>{{ req.name }}</td>
          <td>{{ req.email }}</td>
          <td>{{ req.category|default:"—" }}</td>
          <td class="status-{% if req.status == 'new' %}warning{% elif req.status == 'closed' %}success{% else %}info{% endif %}">{{ req.get_status_display }}</td>
          <td>{{ req.created_at|date:"d.m.Y H:i" }}</td>
          <td><a href="{% url 'main:adminka_request_edit' req.id %}" class="btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.85rem;">Открыть</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p style="text-align: center; padding: 2rem; color: var(--color-text-muted);">Нет заявок</p>
    {% endif %}
  </div>

  <div class="card orders-card" data-aos="fade-up" data-aos-delay="500">
    <h2>Поддержка <a href="{% url 'main:adminka_support' %}" style="font-size: 0.85rem; font-weight: 500;">→ все</a></h2>
    {% if recent_support %}
    <table class="orders-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Имя</th>
          <th>Email</th>
          <th>Статус</th>
          <th>Дата</th>
          <th>Действия</th>
        </tr>
      </thead>
      <tbody>
        {% for req in recent_support %}
        <tr>
          <td>{{ req.id }}</td>
          <td>{{ req.name }}</td>
          <td>{{ req.email }}</td>
          <td class="status-{% if req.status == 'new' %}warning{% elif req.status == 'closed' %}success{% else %}info{% endif %}">{{ req.get_status_display }}</td>
          <td>{{ req.created_at|date:"d.m.Y H:i" }}</td>
          <td><a href="{% url 'main:adminka_support_edit' req.id %}" class="btn-primary" style="padding: 0.25rem 0.5rem; font-size: 0.85rem;">Открыть</a></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    {% else %}
    <p style="text-align: center; padding: 2rem; color: var(--color-text-muted);">Нет обращений</p>
    {% endif %}
  </div>
</main>
{% endblock %}
