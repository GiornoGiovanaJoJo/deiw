{% extends 'adminka/base.html' %}
{% load static %}

{% block title %}Редактировать заявку - Empire Premium{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'adminka/css/pages/support-edit.css' %}" />
{% endblock %}

{% block content %}
<main class="dashboard">
    <div class="page-actions" data-aos="fade-up">
        <h1 data-i18n="support.edit.title">Редактировать заявку #{{ request.id }}</h1>
        <a href="{% url 'main:adminka_support' %}" class="btn-secondary">
            <span><i class="fa-solid fa-arrow-left"></i></span>
            <span data-i18n="support.back">Назад к списку</span>
        </a>
    </div>

    {% if messages %}
      {% for message in messages %}
        <div class="form-message {% if message.tags %}{{ message.tags }}{% endif %}" style="margin-bottom: 1rem;">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}

    <div class="card" data-aos="fade-up" data-aos-delay="200">
        <div class="request-info">
            <h3>Информация о заявке</h3>
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Имя:</span>
                    <span class="info-value">{{ request.name }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Email:</span>
                    <span class="info-value">{{ request.email }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Телефон:</span>
                    <span class="info-value">{{ request.phone }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Причина:</span>
                    <span class="info-value">{{ request.get_reason_display }}</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Дата создания:</span>
                    <span class="info-value">{{ request.created_at|date:"d.m.Y H:i" }}</span>
                </div>
            </div>

            {% if request.message %}
            <div class="message-section">
                <h4>Сообщение клиента:</h4>
                <p>{{ request.message|linebreaks }}</p>
            </div>
            {% endif %}
        </div>

        <form method="POST" class="support-form">
            {% csrf_token %}
            
            <div class="form-group">
                <label for="status">Статус *</label>
                <select id="status" name="status" required>
                    <option value="new" {% if request.status == 'new' %}selected{% endif %}>Новая</option>
                    <option value="in_progress" {% if request.status == 'in_progress' %}selected{% endif %}>В процессе</option>
                    <option value="closed" {% if request.status == 'closed' %}selected{% endif %}>Закрыта</option>
                </select>
            </div>

            <div class="form-group">
                <label for="message_admin">Ответ администратора</label>
                <textarea id="message_admin" name="message_admin" rows="6" placeholder="Введите ваш ответ...">{{ request.message_admin }}</textarea>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn-primary">
                    <span><i class="fa-solid fa-save"></i></span>
                    <span>Сохранить изменения</span>
                </button>
                <a href="{% url 'main:adminka_support' %}" class="btn-secondary">
                    <span>Отмена</span>
                </a>
            </div>
        </form>
    </div>
</main>
{% endblock %}
