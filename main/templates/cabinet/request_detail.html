{% extends 'cabinet/base.html' %}
{% load static %}

{% block title %}Заявка #{{ req_obj.display_number }} - Empire Premium{% endblock %}

{% block content %}
<div class="page-title">Заявка</div>

<div style="display: flex; gap: 4rem;">
    <!-- Main Info Column -->
    <div style="flex: 1;">
        <div class="item-card"
            style="align-items: flex-start; flex-direction: column; gap: 1rem; background: transparent; padding: 0;">
            <div class="card-status">
                <span style="font-weight: 700; color: var(--primary-color);">{{ req_obj.get_status_display }}</span>
            </div>

            <div style="display: grid; grid-template-columns: 150px 1fr; gap: 1rem; width: 100%;">
                <div style="font-weight: 600;">Название</div>
                <div>{{ req_obj.message|truncatewords:10|default:"—" }}</div>

                <div style="font-weight: 600;">Номер</div>
                <div>{{ req_obj.display_number }}</div>

                <div style="font-weight: 600;">Категория</div>
                <div>{{ req_obj.category.name|default:"—" }}</div>

                <div style="font-weight: 600;">Услуги</div>
                <div>
                    {% for k, v in req_obj.extra_answers.items %}
                    <div>{{ k }}: {{ v }}</div>
                    {% empty %}
                    —
                    {% endfor %}
                </div>

                <div style="font-weight: 600;">Создан</div>
                <div>{{ req_obj.created_at|date:"d.m.Y" }}</div>

                <div style="font-weight: 600;">Статус</div>
                <div>{{ req_obj.get_status_display }}</div>
            </div>
        </div>
    </div>

    <!-- Timeline Column -->
    <div style="flex: 1;">
        <h2 style="font-size: 2rem; font-weight: 800; margin-bottom: 2rem;">История заявки</h2>

        <div class="timeline">
            {% for stage in stages %}
            <div class="timeline-item">
                <div class="timeline-icon">
                    {% if forloop.counter == 1 %}<i class="fa-solid fa-pen"></i>
                    {% elif forloop.counter == 2 %}<i class="fa-solid fa-check"></i>
                    {% elif forloop.counter == 3 %}<i class="fa-solid fa-users"></i>
                    {% else %}<i class="fa-solid fa-gear"></i>{% endif %}
                </div>
                <div class="timeline-content">
                    <div class="timeline-title">{{ stage.title }}</div>
                    <div style="color: var(--text-secondary);">{{ stage.description|default:"" }}</div>
                </div>
            </div>
            {% empty %}
            <p>История пуста</p>
            {% endfor %}
        </div>
    </div>
</div>
{% endblock %}