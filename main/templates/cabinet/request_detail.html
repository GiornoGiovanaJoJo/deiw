{% extends 'cabinet/base.html' %}
{% load static %}

{% block title %}Заявка #{{ req_obj.display_number }} - Empire Premium{% endblock %}

{% block content %}
<div class="page-actions cabinet-detail-header" data-aos="fade-up">
    <h1 class="cabinet-detail-title">Заявка <span class="cabinet-detail-title-icon"></span></h1>
    <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        <a href="{% url 'main:cabinet_request_edit' req_obj.pk %}" class="btn-primary" title="Редактировать заявку"><i class="fa-solid fa-pen"></i> Редактировать</a>
        <a href="{% url 'main:cabinet_requests' %}" class="btn-secondary"><i class="fa-solid fa-arrow-left"></i> Назад к заявкам</a>
    </div>
</div>

<div class="cabinet-detail-grid" data-aos="fade-up">
    <div class="card cabinet-detail-card">
        <div class="cabinet-detail-row"><span class="cabinet-detail-label">Название</span><span class="cabinet-detail-value">{{ req_obj.message|truncatewords:10|default:"Название заявки" }}</span></div>
        <div class="cabinet-detail-row"><span class="cabinet-detail-label">Номер</span><span class="cabinet-detail-value">{{ req_obj.display_number }}</span></div>
        <div class="cabinet-detail-row"><span class="cabinet-detail-label">Категория</span><span class="cabinet-detail-value">{{ req_obj.category|default:"—" }}</span></div>
        <div class="cabinet-detail-row"><span class="cabinet-detail-label">Услуги</span><span class="cabinet-detail-value">{% for k, v in req_obj.extra_answers.items %}{{ v }}{% if not forloop.last %}, {% endif %}{% empty %}—{% endfor %}</span></div>
        <div class="cabinet-detail-row"><span class="cabinet-detail-label">Создан</span><span class="cabinet-detail-value">{{ req_obj.created_at|date:"d.m.Y" }}</span></div>
        <div class="cabinet-detail-row"><span class="cabinet-detail-label">Завершен</span><span class="cabinet-detail-value">{{ req_obj.get_status_display }}</span></div>
    </div>
    <div class="card cabinet-detail-card">
        <h2 class="cabinet-detail-card-heading">История заявки</h2>
        {% for stage in stages %}
        <div class="cabinet-stage-card">
            <div class="cabinet-stage-icon"><i class="fa-solid fa-{% if forloop.counter == 1 %}pen{% elif forloop.counter == 2 %}check{% elif forloop.counter == 3 %}users{% else %}gear{% endif %}"></i></div>
            <div class="cabinet-stage-body">
                <div class="cabinet-stage-title">{{ stage.title }}</div>
                <div class="cabinet-stage-desc">{{ stage.description|default:"Описание" }}</div>
            </div>
            <div class="cabinet-stage-placeholder"></div>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
