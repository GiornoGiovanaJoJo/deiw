# Кастомная админка Empire Premium

## Описание

Кастомная административная панель для управления проектами, категориями и заявками в поддержку.

## Доступ к админке

### URL
- **Кастомная админка**: http://localhost:8000/adminka/
- **Стандартная Django админка**: http://localhost:8000/admin/

### Учетные данные по умолчанию
- **Email**: admin@example.com
- **Username**: admin
- **Пароль**: admin123

## Функционал

### 1. Панель управления (Dashboard)
- Статистика по проектам (всего, завершенных, в работе)
- Количество новых заявок
- Последние заявки в поддержку

### 2. Проекты
- Просмотр списка всех проектов
- Добавление нового проекта
- Редактирование проекта
- Просмотр деталей проекта
- Удаление проекта
- Фильтрация по статусу (запланирован, в работе, завершен)
- Поиск проектов

**Поля проекта:**
- Код проекта (уникальный)
- Название
- Описание
- Категория
- Статус
- Год
- Тип
- Размер
- Цвет
- Дата окончания

### 3. Категории
- Просмотр списка категорий
- Добавление новой категории
- Удаление категории
- Мультиязычность (RU, EN, DE)

### 4. Заявки в поддержку
- Просмотр всех заявок
- Редактирование заявки
- Изменение статуса (новая, в процессе, закрыта)
- Добавление ответа администратора
- Удаление заявки
- Фильтрация по статусу
- Поиск заявок

## Структура файлов

```
main/
├── adminka_views.py              # Views для админки
├── models.py                     # Модели (Category, AdminProject, ContactRequest)
├── urls.py                       # URL маршруты
├── templates/
│   └── adminka/
│       ├── base.html            # Базовый шаблон
│       ├── login.html           # Страница входа
│       ├── dashboard.html       # Главная страница
│       ├── projects.html        # Список проектов
│       ├── project_add.html     # Добавление проекта
│       ├── project_edit.html    # Редактирование проекта
│       ├── project_view.html    # Просмотр проекта
│       ├── support.html         # Заявки в поддержку
│       ├── support_edit.html    # Редактирование заявки
│       ├── categories.html      # Категории
│       └── components/
│           ├── header.html      # Шапка
│           └── sidebar.html     # Боковое меню
└── static/
    └── adminka/
        ├── css/                 # Стили (скопированы из оригинальной админки)
        └── js/                  # JavaScript (скопирован из оригинальной админки)
```

## Модели базы данных

### Category
- `name` - Название (RU)
- `name_en` - Название (EN)
- `name_de` - Название (DE)
- `created_at` - Дата создания

### AdminProject
- `project_code` - Уникальный код проекта
- `name` - Название
- `description` - Описание
- `category` - Связь с категорией
- `status` - Статус (planned, in_progress, completed)
- `year` - Год
- `type` - Тип
- `size` - Размер
- `color` - Цвет
- `end_date` - Дата окончания
- `created_at` - Дата создания
- `updated_at` - Дата обновления

### ContactRequest
- `name` - Имя
- `phone` - Телефон
- `email` - Email
- `reason` - Причина обращения (project, consult, other)
- `message` - Сообщение клиента
- `status` - Статус (new, in_progress, closed)
- `message_admin` - Ответ администратора
- `admin_id` - ID администратора
- `created_at` - Дата создания

## Особенности

1. **Адаптивный дизайн** - работает на всех устройствах
2. **Темная/светлая тема** - переключатель в шапке
3. **Мультиязычность** - поддержка RU, EN, DE
4. **AJAX удаление** - удаление без перезагрузки страницы
5. **Поиск и фильтрация** - быстрый поиск по проектам и заявкам
6. **Анимации** - плавные анимации при загрузке (AOS)

## Создание нового администратора

```bash
python manage.py createsuperuser
```

## Миграции

Если вы изменили модели, выполните:

```bash
python manage.py makemigrations
python manage.py migrate
```

## Безопасность

- Доступ к админке только для пользователей с `is_staff=True`
- CSRF защита на всех формах
- Проверка прав доступа через декораторы `@login_required` и `@user_passes_test`

## Дизайн

Дизайн полностью скопирован из оригинальной PHP админки:
- Все CSS файлы из `library/css/`
- Все JS файлы из `library/js/`
- Компоненты: header, sidebar, theme-switcher, language-switcher
- Страницы: login, dashboard, projects, support, categories

## Отличия от стандартной Django админки

1. **Кастомный дизайн** - современный UI/UX
2. **Отдельный роут** - `/adminka/` вместо `/admin/`
3. **Расширенный функционал** - больше возможностей для управления проектами
4. **Мультиязычность** - встроенная поддержка нескольких языков
5. **Темы** - светлая и темная тема

## Управление пользователями

### Создание администраторов для /adminka

Чтобы пользователь мог войти в `/adminka`, он должен быть создан через стандартную админку `/admin` с правами **Staff**.

**Быстрый способ:**
1. Перейдите в `/admin/auth/user/`
2. Создайте нового пользователя
3. Установите галочку **"Staff status"** ✅
4. Сохраните

**Подробная инструкция**: См. файл `ADMIN_USERS_GUIDE.md`

### Управление данными /adminka через /admin

Теперь модели кастомной админки доступны в стандартной Django админке:

- **Categories** (`/admin/main/category/`) - управление категориями
- **Admin Projects** (`/admin/main/adminproject/`) - управление проектами
- **Contact Requests** (`/admin/main/contactrequest/`) - управление заявками

Это позволяет:
- Создавать и редактировать данные через любую админку
- Использовать встроенные возможности Django (фильтры, поиск, экспорт)
- Управлять правами доступа к моделям

## Исправленные проблемы

### ✅ Исправлена ошибка 404 для файлов переводов

**Проблема**: `Not Found: /adminka/login/library/lang/de.json`

**Решение**: 
- Файлы переводов скопированы в `main/static/adminka/lang/`
- Обновлен JavaScript для правильной загрузки переводов
- Добавлена глобальная переменная `LANG_PATH` в шаблонах

Теперь переводы загружаются корректно из статических файлов Django.

## Поддержка

Обе админки работают параллельно:
- `/admin/` - стандартная Django админка (управление пользователями и системой)
- `/adminka/` - кастомная админка (работа с проектами и заявками)

Вы можете использовать любую из них в зависимости от ваших потребностей.
